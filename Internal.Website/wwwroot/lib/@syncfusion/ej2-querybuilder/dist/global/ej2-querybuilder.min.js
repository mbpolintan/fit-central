/*!
*  filename: ej2-querybuilder.min.js
*  version : 18.2.47
*  Copyright Syncfusion Inc. 2001 - 2020. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
this.ej=this.ej||{},this.ej.querybuilder=function(e,t,l,r,n,i,o,s,a){"use strict";var u=function(){var e=function(t,l){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(t,l)};return function(t,l){function r(){this.constructor=t}e(t,l),t.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),d=function(e,t,l,r){var n,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,l):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,l,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(i<3?n(o):i>3?n(t,l,o):n(t,l))||o);return i>3&&o&&Object.defineProperty(t,l,o),o},p=function(e,t,l,r){return new(l||(l=Promise))(function(n,i){function o(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?n(e.value):new l(function(t){t(e.value)}).then(o,s)}a((r=r.apply(e,t||[])).next())})},c=function(e,t){function l(e){return function(t){return r([e,t])}}function r(l){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&l[0]?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],i=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}var n,i,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},h=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return u(l,e),d([t.Property(null)],l.prototype,"field",void 0),d([t.Property(null)],l.prototype,"label",void 0),d([t.Property(null)],l.prototype,"type",void 0),d([t.Property(null)],l.prototype,"values",void 0),d([t.Property(null)],l.prototype,"operators",void 0),d([t.Property()],l.prototype,"ruleTemplate",void 0),d([t.Property(null)],l.prototype,"template",void 0),d([t.Property({isRequired:!0,min:0,max:Number.MAX_VALUE})],l.prototype,"validation",void 0),d([t.Property(null)],l.prototype,"format",void 0),d([t.Property(null)],l.prototype,"step",void 0),d([t.Property(null)],l.prototype,"value",void 0),d([t.Property(null)],l.prototype,"category",void 0),l}(t.ChildProperty),m=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return u(l,e),d([t.Property(null)],l.prototype,"condition",void 0),d([t.Collection([],l)],l.prototype,"rules",void 0),d([t.Property(null)],l.prototype,"field",void 0),d([t.Property(null)],l.prototype,"label",void 0),d([t.Property(null)],l.prototype,"type",void 0),d([t.Property(null)],l.prototype,"operator",void 0),d([t.Property(null)],l.prototype,"value",void 0),d([t.Property(!1)],l.prototype,"not",void 0),l}(t.ChildProperty),g=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return u(l,e),d([t.Property(!0)],l.prototype,"ruleDelete",void 0),d([t.Property(!0)],l.prototype,"groupInsert",void 0),d([t.Property(!0)],l.prototype,"groupDelete",void 0),l}(t.ChildProperty),f=function(e){function h(t,l){var n=e.call(this,t,l)||this;return n.isReadonly=!0,n.fields={text:"label",value:"field"},n.updatedRule={not:!1,condition:"and"},n.isLocale=!1,r.MultiSelect.Inject(r.CheckBoxSelection),n}return u(h,e),h.prototype.getPersistData=function(){return this.addOnPersist(["rule"])},h.prototype.reset=function(){this.isImportRules=!1;var e=this.element.querySelector(".e-group-body");e.innerHTML="",this.enableNotCondition&&t.removeClass(this.element.querySelectorAll(".e-qb-toggle"),"e-active-toggle"),e.appendChild(this.createElement("div",{attrs:{class:"e-rule-list"}})),this.levelColl[this.element.id+"_group0"]=[0],this.rule={condition:"and",not:!1,rules:[]},this.disableRuleCondition(e.parentElement)},h.prototype.getWrapper=function(){return this.element},h.prototype.getModuleName=function(){return"query-builder"},h.prototype.initialize=function(){if(this.dataColl.length){var e=Object.keys(this.dataColl[0]),t=[],l=[],r=void 0,n=!1,i=!1,o=void 0,s={isRequired:!0,min:0,max:Number.MAX_VALUE};if(this.columns.length){this.columnSort();for(var a=0,u=(d=this.columns).length;a<u;a++)this.updateCustomOperator(d[a]),d[a].type||(e.indexOf(d[a].field)>-1&&("string"===(r=typeof(o=this.dataColl[0][d[a].field]))?i=!isNaN(Date.parse(o)):"object"===r&&(i=o instanceof Date&&!isNaN(o.getTime()),r="string"),d[a].type=r,i=!1),r="string"),d[a].validation||(d[a].validation=s),d[a].category?n=!0:d[a].category=this.l10n.getConstant("OtherFields"),l.indexOf(d[a].category)<0&&l.push(d[a].category),d[a].operators&&!this.isLocale||(d[a].operators=this.customOperators[d[a].type+"Operator"]);n&&(l.length>1||l[0]!==this.l10n.getConstant("OtherFields"))&&(this.fields={text:"label",value:"field",groupBy:"category"})}else{for(var a=0,u=e.length;a<u;a++)"string"===(r=typeof(o=this.dataColl[0][e[a]]))?i=!isNaN(Date.parse(o)):"object"===r&&(i=o instanceof Date&&!isNaN(o.getTime()),r="string"),t[a]={field:e[a],label:e[a],type:i?"date":r,validation:s},i=!1,t[a].operators=this.customOperators[t[a].type+"Operator"];this.columns=t}}else if(this.columns.length)for(var d=this.columns,a=0,u=d.length;a<u;a++)d[a].category?this.fields={text:"label",value:"field",groupBy:"category"}:d[a].category=this.l10n.getConstant("OtherFields"),this.updateCustomOperator(d[a]),d[a].operators&&!this.isLocale||(d[a].operators=this.customOperators[d[a].type+"Operator"])},h.prototype.updateCustomOperator=function(e){if(e.operators)for(var t=this,l=0;l<e.operators.length;l++)!function(l){var r=Object.keys(e.operators[l]).indexOf("sqlOperator");if(r>-1){var n=e.operators[l],i=Object.keys(n),o=i.map(function(e){return n[e]}).join(",").split(","),s=i.indexOf("value");t.operators[o[s]]=o[r]}}(l)},h.prototype.focusEventHandler=function(e){this.target=e.target},h.prototype.clickEventHandler=function(e){var l,r=this,n=e.target;this.isImportRules=!1;var i;if("SPAN"===n.tagName&&(n=n.parentElement),n.className.indexOf("e-collapse-rule")>-1){var o=new t.Animation({duration:1e3,delay:0});this.element.querySelectorAll(".e-summary-content").length<1&&this.renderSummary();var s=document.getElementById(this.element.id+"_summary_content"),a=s.querySelector(".e-summary-text");o.animate(".e-query-builder",{name:"SlideLeftIn"}),(d=this.element.querySelector(".e-group-container")).style.display="none",a.textContent=this.getSqlFromRules(this.rule),s.style.display="block",a.style.height=a.scrollHeight+"px"}if("BUTTON"===n.tagName&&n.className.indexOf("e-qb-toggle")<0){if(n.className.indexOf("e-removerule")>-1)this.actionButton=n,this.deleteRule(n);else if(n.className.indexOf("e-deletegroup")>-1)this.actionButton=n,this.deleteGroup(t.closest(n,".e-group-container"));else if(n.className.indexOf("e-edit-rule")>-1)if((o=new t.Animation({duration:1e3,delay:0})).animate(".e-query-builder",{name:"SlideLeftIn"}),document.getElementById(this.element.id+"_summary_content").style.display="none",this.element.querySelectorAll(".e-group-container").length<1){this.addGroupElement(!1,this.element,this.rule.condition);var u=t.extend({},this.rule,{},!0);this.setGroupRules(u),this.renderSummaryCollapse()}else{var d=this.element.querySelector(".e-group-container");d.querySelectorAll(".e-collapse-rule").length<1&&this.renderSummaryCollapse(),d.style.display="block"}}else if("LABEL"===n.tagName&&n.parentElement.className.indexOf("e-btn-group")>-1||n.className.indexOf("e-qb-toggle")>-1){var p=t.closest(n,".e-group-container"),c=n.getAttribute("for"),h=void 0;c&&(h=document.getElementById(c).getAttribute("value")),i=p.id.replace(this.element.id+"_","");var m=this.getGroup(i),g=void 0;if(this.enableNotCondition)if(n.className.indexOf("e-qb-toggle")>-1){var f=p.getElementsByClassName("e-qb-toggle")[0];f.className.indexOf("e-active-toggle")>-1?(t.removeClass([f],"e-active-toggle"),g=!1):(t.addClass([f],"e-active-toggle"),g=!0),h=m.condition}else g=m.not;l={groupID:i,cancel:!1,type:"condition",value:h.toLowerCase()},this.enableNotCondition&&(l={groupID:i,cancel:!1,type:"condition",value:h.toLowerCase(),not:g}),this.isImportRules?this.beforeSuccessCallBack(l,n):this.trigger("beforeChange",l,function(e){r.beforeSuccessCallBack(e,n)})}this.target=n},h.prototype.beforeSuccessCallBack=function(e,l){if(!e.cancel){var r=t.closest(l,".e-group-container"),n=r.id.replace(this.element.id+"_",""),i=this.getValidRules(this.rule),o=this.getParentGroup(r);o.condition=e.value,this.enableNotCondition&&(o.not=e.not),this.isImportRules||this.trigger("change",{groupID:n,type:"condition",value:o.condition}),this.filterRules(i,this.getValidRules(this.rule),"condition")}},h.prototype.selectBtn=function(e,l){"beforeOpen"===l.name?this.showButtons.groupInsert?t.removeClass([l.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"):t.addClass([l.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"):l.element.children[0].className.indexOf("e-addrule")>-1?this.addRuleElement(t.closest(e,".e-group-container"),{}):l.element.children[0].className.indexOf("e-addgroup")>-1&&this.addGroupElement(!0,t.closest(e,".e-group-container"),"",!0)},h.prototype.appendRuleElem=function(e,t,l,r,n,i){var o,s,a,u=e.querySelector(".e-rule-list");if("change"===l?o=e.querySelector("#"+r):((o=this.createElement("div",{attrs:{class:"e-rule-container"}})).setAttribute("id",e.id+"_rule"+this.ruleIdCounter),u.appendChild(o),this.ruleIdCounter++),t&&t.ruleTemplate){a={requestType:"template-initialize",ruleID:o.id,action:n,fields:this.fields,rule:i},this.trigger("actionBegin",a),this.ruleTemplateFn=this.templateParser(t.ruleTemplate);var d=this.element.id+t.field;a.fields=this.fields,a.columns=this.columns,a.operators=this.getOperators(i.field),a.operatorFields={text:"key",value:"value"},(s=this.ruleTemplateFn(a,this,"Template",d)[0]).className+=" e-rule-field"}else s=this.ruleElem.querySelector(".e-rule-field").cloneNode(!0);return o.appendChild(s),o},h.prototype.addRuleElement=function(e,t,l,r,n,i){var o=this;if(e){var s={groupID:e.id.replace(this.element.id+"_",""),cancel:!1,type:"insertRule"};this.isImportRules||this.isInitialLoad?(this.isInitialLoad=!1,this.addRuleSuccessCallBack(s,e,t,l,r,n,i)):this.trigger("beforeChange",s,function(s){o.addRuleSuccessCallBack(s,e,t,l,r,n,i)})}},h.prototype.addRuleSuccessCallBack=function(e,l,n,i,o,s,u){var d,p,c,h,m=this.element.className.indexOf("e-device")>-1?"250px":"200px",g=n&&n.field?this.getColumn(n.field):i||this.columns[0],f={label:"",field:"",type:"",operator:""};if(!e.cancel){if(g&&g.ruleTemplate){this.selectedColumn=g,p=this.selectedColumn.operators,f={label:g.label,field:g.field,type:g.type,operator:p[0].value};var y=Object.keys(n).length?n:f,v={requestType:"template-create",action:"insert-rule",ruleID:(h=this.appendRuleElem(l,g,o,s,"field",y)).id,fields:this.fields,rule:y};this.trigger("actionBegin",v)}else{(h=this.appendRuleElem(l,g,o,s,"field")).querySelector(".e-filter-input").setAttribute("id",h.id+"_filterkey");var b=h.querySelector("button");this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?(b.textContent=this.l10n.getConstant("Remove"),t.addClass([b],"e-flat"),t.addClass([b],"e-primary")):(t.addClass([b],"e-round"),t.addClass([b],"e-icon-btn"),new a.Tooltip({content:this.l10n.getConstant("DeleteRule")}).appendTo(b),b=this.createElement("span",{attrs:{class:"e-btn-icon e-icons e-delete-icon"}}),h.querySelector("button").appendChild(b))}"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?h.className="e-rule-container e-vertical-mode":h.className="e-rule-container e-horizontal-mode",h.previousElementSibling&&h.previousElementSibling.className.indexOf("e-rule-container")>-1&&(h.className.indexOf("e-joined-rule")<0&&(h.className+=" e-joined-rule"),h.previousElementSibling.className.indexOf("e-prev-joined-rule")<0&&(h.previousElementSibling.className+=" e-prev-joined-rule")),h.previousElementSibling&&h.previousElementSibling.className.indexOf("e-group-container")>-1&&h.className.indexOf("e-separate-rule")<0&&(h.className+=" e-separate-rule"),this.isImportRules||this.updateAddedRule(l,n,f,u),(!g||g&&!g.ruleTemplate)&&((c=new r.DropDownList({dataSource:this.columns,fields:this.fields,placeholder:this.l10n.getConstant("SelectField"),popupHeight:this.columns.length>5?m:"auto",change:this.changeField.bind(this),value:n?n.field:null})).appendTo("#"+h.id+"_filterkey"),this.selectedColumn=c.getDataByValue(c.value),Object.keys(n).length&&this.changeRule(n,{element:c.element,itemData:this.selectedColumn})),d=h.id.replace(this.element.id+"_",""),this.isImportRules||this.trigger("change",{groupID:l.id.replace(this.element.id+"_",""),ruleID:d,type:"insertRule"})}},h.prototype.updateAddedRule=function(e,l,r,n){for(var i=t.closest(e,".e-group-container"),o=this.getParentGroup(i),s=t.closest(e,".e-rule-container"),a=0;s&&null!==s.previousElementSibling;)s=s.previousElementSibling,a++;n?o.rules[a]=l:Object.keys(l).length?o.rules.push({field:l.field,type:l.type,label:l.label,operator:l.operator,value:l.value}):o.rules.push(r),this.disableRuleCondition(e,o)},h.prototype.changeRuleTemplate=function(e,l,r,n){var i=this.selectedColumn.operators;if(!e.ruleTemplate){var o=t.closest(l,".e-rule-container").id;if(this.previousColumn&&this.previousColumn.ruleTemplate&&t.detach(l.closest("#"+o).querySelector(".e-rule-field")),e){var s={field:e.field,label:e.label,operator:i[0].value,value:""};this.addRuleElement(this.element.querySelector(".e-group-container"),s,e,"change",o,!0)}}},h.prototype.renderToolTip=function(e){var t=new a.Tooltip({content:this.l10n.getConstant("ValidationMessage"),position:"BottomCenter",cssClass:"e-querybuilder-error"});t.appendTo(e),t.open(e)},h.prototype.validateFields=function(){var e=!0;if(this.allowValidation){var l=void 0,r=void 0,n=void 0,i=void 0,o=[],s=void 0,a=void 0,u=void 0,d=void 0,p=void 0,c=this.element.querySelectorAll(".e-rule-container"),h=void 0;for(l=0,r=c.length;l<r;l++)if(s=t.closest(c[l],".e-group-container"),p=this.getParentGroup(s),a=0,i=d=c[l],u=t.getComponent(c[l].querySelector(".e-rule-field input.e-control"),"dropdownlist"),this.selectedColumn=u.getDataByValue(u.value),h=!t.isNullOrUndefined(u.index)&&this.selectedColumn.validation,n=d.querySelector(".e-rule-field input.e-control"),h&&h.isRequired){for(;i&&null!==i.previousElementSibling;)i=i.previousElementSibling,a++;if(n=d.querySelector(".e-rule-field input.e-control"),p.rules[a].field||(n.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(n.parentElement),e=!1),n=d.querySelector(".e-rule-operator input.e-control"),p.rules[a].operator||(n.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(n.parentElement),e=!1),p.rules[a].value instanceof Array&&(o=p.rules[a].value),t.isNullOrUndefined(p.rules[a].value)||""===p.rules[a].value||p.rules[a].value instanceof Array&&o.length<1){var m=d.querySelectorAll(".e-rule-value input.e-control");e=!1;for(var g=0,f=m.length;g<f;g++){var y=m[g],v=void 0;y.parentElement.className.indexOf("e-searcher")>-1?(v=t.closest(y,".e-multi-select-wrapper")).className.indexOf("e-tooltip")<0&&this.renderToolTip(v):m[g].parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(m[g].parentElement),g++}}}else u.element&&t.isNullOrUndefined(u.index)&&(n.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(n.parentElement),e=!1)}return e},h.prototype.refreshLevelColl=function(){this.levelColl={};var e=this.element.querySelector(".e-group-container");this.levelColl[e.id]=[0];var t={groupElement:e,level:[0]};this.refreshLevel(t)},h.prototype.refreshLevel=function(e){var l,r,n=e.groupElement.querySelector(".e-rule-list").children,i=e.groupElement,o=n.length,s=0;for(r=0;r<o;r++)(l=n[r]).className.indexOf("e-group-container")>-1&&(e.level.push(s),this.levelColl[l.id]=e.level.slice(),s++,e.groupElement=l,e=this.refreshLevel(e));var a=t.closest(i,".e-rule-list");return e.groupElement=a?t.closest(a,".e-group-container"):i,e.level=this.levelColl[e.groupElement.id].slice(),e},h.prototype.groupTemplate=function(){var e,t,l,r,n,i,o,s,a;return e=this.createElement("div",{attrs:{class:"e-group-container"}}),l=this.createElement("div",{attrs:{class:"e-group-header"}}),t=this.createElement("div",{attrs:{class:"e-group-body"}}),r=this.createElement("div",{attrs:{class:"e-rule-list"}}),e.appendChild(l),t.appendChild(r),e.appendChild(t),n=this.createElement("div",{attrs:{class:"e-lib e-btn-group"}}),this.enableNotCondition&&(i=this.createElement("button",{attrs:{type:"button",class:"e-qb-toggle"}}),n.appendChild(i)),(i=this.createElement("input",{attrs:{type:"radio",class:"e-btngroup-and",value:"AND"}})).setAttribute("checked","true"),n.appendChild(i),o=this.createElement("label",{attrs:{class:"e-lib e-btn e-btngroup-and-lbl e-small"},innerHTML:this.l10n.getConstant("AND")}),n.appendChild(o),i=this.createElement("input",{attrs:{type:"radio",class:"e-btngroup-or",value:"OR"}}),n.appendChild(i),o=this.createElement("label",{attrs:{class:"e-lib e-btn e-btngroup-or-lbl e-small"},innerHTML:this.l10n.getConstant("OR")}),n.appendChild(o),l.appendChild(n),s=this.createElement("div",{attrs:{class:"e-group-action"}}),a=this.createElement("button",{attrs:{type:"button",class:"e-add-btn"}}),s.appendChild(a),l.appendChild(s),e},h.prototype.ruleTemplate=function(){var e,t,l,r,n,i;return e=this.createElement("div"),n=this.createElement("div",{attrs:{class:"e-rule-field"}}),l=this.createElement("div",{attrs:{class:"e-rule-filter"}}),t=this.createElement("input",{attrs:{type:"text",class:"e-filter-input"}}),l.appendChild(t),n.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-operator"}}),n.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-value"}}),n.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-value-delete"}}),i=this.showButtons.ruleDelete?"e-removerule e-rule-delete e-css e-btn e-small":"e-removerule e-rule-delete e-css e-btn e-small e-button-hide",r=this.createElement("button",{attrs:{class:i}}),l.appendChild(r),n.appendChild(l),e.appendChild(n),e},h.prototype.addGroupElement=function(e,t,l,r){var n=this,i={groupID:t.id.replace(this.element.id+"_",""),cancel:!1,type:"insertGroup"};this.isImportRules||this.isInitialLoad?(this.isInitialLoad=!1,this.addGroupSuccess(i,e,t,l,r)):this.trigger("beforeChange",i,function(i){n.addGroupSuccess(i,e,t,l,r)})},h.prototype.addGroupSuccess=function(e,r,n,i,o){if(!e.cancel&&this.element.querySelectorAll(".e-group-container").length<=this.maxGroupCount){var u=n,d=void 0,p=this.groupElem.cloneNode(!0);p.setAttribute("id",this.element.id+"_group"+this.groupIdCounter),this.groupIdCounter++;var c=p.querySelector(".e-btngroup-and"),h=p.querySelector(".e-btngroup-or"),m=p.querySelector(".e-btngroup-and-lbl"),g=p.querySelector(".e-btngroup-or-lbl"),f=p.querySelector(".e-qb-toggle");if(c.setAttribute("id",this.element.id+"_and"+this.btnGroupId),h.setAttribute("id",this.element.id+"_or"+this.btnGroupId),c.setAttribute("name",this.element.id+"_and"+this.btnGroupId),h.setAttribute("name",this.element.id+"_and"+this.btnGroupId),m.setAttribute("for",this.element.id+"_and"+this.btnGroupId),g.setAttribute("for",this.element.id+"_or"+this.btnGroupId),this.btnGroupId++,r){var y=this.showButtons.groupDelete?"e-deletegroup":"e-deletegroup e-button-hide";d=this.createElement("button",{attrs:{class:y}}),new l.Button({iconCss:"e-icons e-delete-icon",cssClass:"e-small e-round"}).appendTo(d),new a.Tooltip({content:this.l10n.getConstant("DeleteGroup")}).appendTo(d),t.rippleEffect(d,{selector:".deletegroup"}),p.querySelector(".e-group-action").appendChild(d);for(var v=u.querySelector(".e-rule-list"),b=v.children,C=0,S=0,x=b.length;S<x;S++)b[S].className.indexOf("e-group-container")>-1&&(C+=1);v.appendChild(p);var O=this.levelColl[u.id].slice(0);O.push(C),this.levelColl[p.id]=O,this.isImportRules||(this.addGroups([],u.id.replace(this.element.id+"_","")),o&&this.addRuleElement(p,{}))}else u.appendChild(p),this.levelColl[p.id]=[0];this.enableNotCondition&&(new l.Button({content:this.l10n.getConstant("NOT"),cssClass:"e-btn e-small"}).appendTo(f),p.querySelector(".e-btngroup-and-lbl").classList.add("e-not"),this.updatedRule&&this.updatedRule.not&&t.addClass([f],"e-active-toggle")),this.updatedRule=null;var E=p.querySelector(".e-add-btn");if(new s.DropDownButton({items:this.items,cssClass:"e-round e-small e-caret-hide e-addrulegroup",iconCss:"e-icons e-add-icon",beforeOpen:this.selectBtn.bind(this,E),select:this.selectBtn.bind(this,E)}).appendTo(E),!this.isImportRules){var w=u.id.replace(this.element.id+"_",""),N=p.id.replace(this.element.id+"_","");this.trigger("change",{groupID:w,type:"insertGroup",childGroupID:N})}}},h.prototype.notifyChange=function(e,l,r){for(var n=t.closest(l,".e-group-container"),i=this.getParentGroup(n),o=t.closest(l,".e-rule-container"),s=0;o&&null!==o.previousElementSibling;)o=o.previousElementSibling,s++;var a=i.rules[s],u=this.getColumn(a.field),d=this.getFormat(u.format);if("date"===u.type)if(e instanceof Date)e=this.intl.formatDate(e,d);else if(e instanceof Array)for(g=0;g<e.length;g++)e[g]instanceof Date&&(e[g]=this.intl.formatDate(e[g],d));if(u.ruleTemplate)this.templateChange(l,e,r);else{var p=t.closest(l,".e-rule-value").querySelectorAll(".e-template"),c=t.closest(l,".e-rule-container").querySelector(".e-filter-input"),h=t.getComponent(c,"dropdownlist");u=h.getDataByValue(h.value);for(var m=[],g=0,f=p.length;g<f;g++)"date"===u.type&&e[g]instanceof Date?m.push(this.intl.formatDate(e[g],d)):m=e;this.updateRules(l,p.length>1?m:e)}},h.prototype.templateChange=function(e,l,r){for(var n=t.closest(e,".e-group-container"),i=this.getParentGroup(n),o=t.closest(e,".e-rule-container"),s=0;o&&null!==o.previousElementSibling;)o=o.previousElementSibling,s++;var a=i.rules[s];"field"===r?this.selectedColumn=this.getColumn(l):a&&(this.selectedColumn=this.getColumn(a.field));var u;this.previousColumn=this.getColumn(a.field);var d=this.getValidRules(this.rule);this.selectedColumn&&(u=this.selectedColumn.operators?this.selectedColumn.operators:this.customOperators[this.selectedColumn.type+"Operator"]);var p,c=["in","notin","between","notbetween"];switch(r){case"field":a.field=l,a.label=this.selectedColumn.label,a.type=this.selectedColumn.type,a.value="",a.operator=u[0].value;break;case"operator":p=a.operator,a.operator=l,c.indexOf(a.operator)>-1?a.value=[]:c.indexOf(p)>-1&&(a.value="");break;case"value":a.value=l}if(this.changeRuleTemplate(this.selectedColumn,e,a,r),this.filterRules(d,this.getValidRules(this.rule),r),this.selectedColumn&&this.selectedColumn.ruleTemplate&&("field"===r||"operator"===r)){var h=t.closest(e,".e-rule-container");this.destroyControls(h,!0),t.detach(h.querySelector(".e-rule-field"));var m=this.appendRuleElem(t.closest(h,".e-group-container"),this.selectedColumn,"change",h.id,r,a);"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?m.className="e-rule-container e-vertical-mode":m.className="e-rule-container e-horizontal-mode",m.previousElementSibling&&m.previousElementSibling.className.indexOf("e-rule-container")>-1&&(m.className.indexOf("e-joined-rule")<0&&(m.className+=" e-joined-rule"),m.previousElementSibling.className.indexOf("e-prev-joined-rule")<0&&(m.previousElementSibling.className+=" e-prev-joined-rule")),m.previousElementSibling&&m.previousElementSibling.className.indexOf("e-group-container")>-1&&m.className.indexOf("e-separate-rule")<0&&(m.className+=" e-separate-rule");var g={requestType:"template-create",action:r,ruleID:h.id,fields:this.fields,rule:a};this.trigger("actionBegin",g)}},h.prototype.changeValue=function(e,l){var r,n,i,o=this;((i=l.event?l.event.target:l.element).className.indexOf("e-day")>-1||i.className.indexOf("e-cell")>-1)&&(i=l.element);var s=t.closest(i,".e-group-container"),a=t.closest(i,".e-rule-container");r=s&&s.id.replace(this.element.id+"_",""),n=a.id.replace(this.element.id+"_","");var u=l;u.element&&u.element.className.indexOf("e-datepicker")>-1&&(i=u.element);var d,p,c;i.className.indexOf("e-radio")>-1?(p=parseInt(i.id.split("valuekey")[1],0),c=t.getComponent(t.closest(i,".e-rule-container").querySelector(".e-filter-input"),"dropdownlist"),this.selectedColumn=c.getDataByValue(c.value),d=this.selectedColumn.values?this.selectedColumn.values[p]:[!0,!1][p]):d=i.className.indexOf("e-multiselect")>-1?t.getComponent(i,"multiselect").value:l.value,"input"===l.name&&this.immediateModeDelay?(window.clearInterval(this.timer),this.timer=window.setInterval(function(){o.filterValue(r,n,d,e,i)},this.immediateModeDelay)):this.filterValue(r,n,d,e,i)},h.prototype.filterValue=function(e,t,l,r,n){var i=this,o={groupID:e,ruleID:t,value:l,cancel:!1,type:"value"};window.clearInterval(this.timer),this.isImportRules?this.changeValueSuccessCallBack(o,n,r,e,t):this.trigger("beforeChange",o,function(l){i.changeValueSuccessCallBack(l,n,r,e,t)})},h.prototype.changeValueSuccessCallBack=function(e,t,l,r,n){e.cancel||(this.updateRules(t,e.value,l),this.isImportRules||this.trigger("change",{groupID:r,ruleID:n,value:e.value,cancel:!1,type:"value"}))},h.prototype.changeField=function(e){if(e.isInteracted){var l=this.getColumn(e.value);if(l&&l.ruleTemplate)this.templateChange(e.element,l.field,"field");else{for(var r=t.closest(e.element,".e-group-container"),n=this.getParentGroup(r),i=t.closest(e.element,".e-rule-container"),o=0;i&&null!==i.previousElementSibling;)i=i.previousElementSibling,o++;this.changeRule(n.rules[o],e)}}},h.prototype.changeRule=function(e,l){if(l.itemData){var r={},n=t.closest(l.element,".e-rule-filter"),i=t.getComponent(l.element,"dropdownlist"),o=t.closest(l.element,".e-group-container").id.replace(this.element.id+"_","");this.changeFilter(n,i,o,e,r,l)}},h.prototype.changeFilter=function(e,l,r,n,i,o){var s=this;if(e){this.selectedColumn=l.getDataByValue(l.value);var a=void 0;a={groupID:r,ruleID:t.closest(e,".e-rule-container").id.replace(this.element.id+"_",""),selectedField:l.value,cancel:!1,type:"field"},this.isImportRules?this.fieldChangeSuccess(a,i,e,n,o):this.trigger("beforeChange",a,function(t){s.fieldChangeSuccess(t,i,e,n,o)})}else{var u=t.closest(o.element,".e-rule-operator");this.changeOperator(e,u,l,r,n,i,o)}},h.prototype.changeOperator=function(e,l,r,n,i,o,s){var a,u=this;l?(a={groupID:n,ruleID:t.closest(l,".e-rule-container").id.replace(this.element.id+"_",""),selectedIndex:r.index,cancel:!1,type:"operator"},this.isImportRules?this.operatorChangeSuccess(a,e,o,i,s):this.trigger("beforeChange",a,function(t){u.operatorChangeSuccess(t,e,o,i,s)})):this.changeRuleValues(e,i,o,s)},h.prototype.fieldChangeSuccess=function(e,l,r,n,i){for(var o=t.closest(r,".e-rule-container"),s=t.closest(i.element,".e-rule-operator"),a=t.closest(i.element,".e-group-container").id.replace(this.element.id+"_",""),u=t.getComponent(i.element,"dropdownlist"),d=o.querySelectorAll(".e-tooltip.e-input-group"),p=0;p<d.length;p++)t.getComponent(d[p],"tooltip").destroy();e.cancel?this.changeOperator(r,s,u,a,n,l,i):(l.type=this.selectedColumn.type,o.querySelector(".e-template")&&(n.value=""),this.changeOperator(r,s,u,a,n,l,i))},h.prototype.operatorChangeSuccess=function(e,l,r,n,i){if(!e.cancel){var o=t.closest(i.element,".e-rule-operator"),s=o.nextElementSibling,a=t.getComponent(i.element,"dropdownlist"),u=n.operator?n.operator.toString().toLowerCase():"";r.operator=a.value.toString();var d=r.operator.toLowerCase();if(r.operator.toLowerCase().indexOf("between")>-1||r.operator.toLowerCase().indexOf("in")>-1&&r.operator.toLowerCase().indexOf("contains")<0?(l=o.previousElementSibling,r.type=n.type,(r.operator.toLowerCase().indexOf("in")<0||u.indexOf("in")<0)&&(n.value=[])):"object"==typeof n.value&&null!=n.value&&(n.value=n.value.length>0?n.value[0]:""),i.previousItemData){var p=i.previousItemData.value.toString().toLowerCase();(p.indexOf("between")>-1||(p.indexOf("in")>-1||p.indexOf("null")>-1||p.indexOf("empty")>-1)&&p.indexOf("contains")<0)&&(l=o.previousElementSibling,r.type=n.type)}if(u.indexOf("in")>-1&&u.indexOf("in")<5&&d.indexOf("in")>-1&&d.indexOf("in")<5&&(l=null),r.operator.indexOf("null")>-1||r.operator.indexOf("empty")>-1){var c=o.parentElement.querySelector(".e-rule-value");t.removeClass([c],"e-show"),t.addClass([c],"e-hide")}s&&s.querySelector(".e-template")&&(l=o.previousElementSibling),this.changeRuleValues(l,n,r,i)}},h.prototype.changeRuleValues=function(e,l,n,i){var o,s,a,u=t.closest(i.element,".e-rule-operator");if(e)if(u=e.nextElementSibling,t.addClass([u],"e-operator"),u.childElementCount){o=t.getComponent(u.querySelector(".e-dropdownlist"),"dropdownlist"),n.operator=o.value;var d=i.itemData;this.renderValues(u,d,i.previousItemData,!0,l,n,i.element)}else{var p=t.closest(u,".e-rule-container").id;a=this.createElement("input",{attrs:{type:"text",id:p+"_operatorkey"}}),u.appendChild(a),this.selectedColumn.operators?s=this.selectedColumn.operators:i.itemData&&(s=this.customOperators[this.selectedColumn.type+"Operator"]);var c=this.element.className.indexOf("e-device")>-1?"250px":"200px",h=s[0].value;h=l&&""!==l.operator?l.operator:h,new r.DropDownList({dataSource:s,fields:{text:"key",value:"value"},placeholder:this.l10n.getConstant("SelectOperator"),popupHeight:s.length>5?c:"auto",change:this.changeField.bind(this),index:0,value:h}).appendTo("#"+p+"_operatorkey"),n.operator=l&&""!==l.operator?l.operator:s[0].value,this.isImportRules&&(n.type=this.selectedColumn.type,n.operator=l.operator),this.renderValues(u,this.selectedColumn,i.previousItemData,!1,l,n,i.element)}this.isImportRules||this.updateRules(i.element,i.item)},h.prototype.destroyControls=function(e,l){var r,n=l?e:e.nextElementSibling;r=n.querySelectorAll("input.e-control");var i;i=n.querySelectorAll("div.e-control:not(.e-handle)");for(var o=this.columns,s=0,a=r.length;s<a;s++){if(r[s].classList.contains("e-textbox"))t.getComponent(r[s],"textbox").destroy(),t.detach(n.querySelector("input#"+r[s].id));else if(r[s].classList.contains("e-dropdownlist"))t.getComponent(r[s],"dropdownlist").destroy();else if(r[s].classList.contains("e-radio"))t.getComponent(r[s],"radio").destroy();else if(r[s].classList.contains("e-numerictextbox"))t.getComponent(r[s],"numerictextbox").destroy(),t.detach(n.querySelector("input#"+r[s].id));else if(r[s].classList.contains("e-datepicker"))t.getComponent(r[s],"datepicker").destroy();else if(r[s].classList.contains("e-multiselect"))t.getComponent(r[s],"multiselect").destroy();else if(r[s].className.indexOf("e-template")>-1)for(var u=r[s].className,d=0,p=o.length;d<p;d++)if(o[d].template&&u.indexOf(o[d].field)>-1){this.templateDestroy(o[d],r[s].id);break}document.getElementById(r[s].id)&&t.detach(r[s])}for(var s=0,a=i.length;s<a;s++){if(i[s].className.indexOf("e-template")>-1)for(var u=i[s].className,d=0,p=o.length;d<p;d++)if(o[d].template&&u.indexOf(o[d].field)>-1){this.templateDestroy(o[d],i[s].id);break}t.detach(i[s])}for(var c,s=0,a=(c=n.querySelectorAll(".e-template:not(.e-control)")).length;s<a;s++)t.detach(c[s])},h.prototype.templateDestroy=function(e,l){var r=e.template.destroy;if(e.template&&e.template.destroy){var n=void 0;n=t.closest(document.getElementById(l),".e-rule-field").querySelectorAll(".e-template"),"string"==typeof r?(r=t.getValue(r,window))({field:e.field,elementId:l,elements:n}):e.template.destroy({field:e.field,elementId:l,elements:n})}},h.prototype.getValues=function(e){var t,l={},r=[],n=this.dataColl,i=e.split(".");if(this.dataColl[1])for(var o=0,s=n.length;o<s;o++){var a={};if(i.length>1)for(var u=n[o],d=void 0,p=0,c=i.length;p<c;p++)d=i[p],i.length===p+1?(t=u[d],Number(u[d])===u[d]&&u[d]%1!=0&&(t=u[d].toString())):u=u[d];else t=n[o][e],Number(n[o][e])===n[o][e]&&n[o][e]%1!=0&&(t=n[o][e].toString());t in l||(l[t]=1,i.length>1?this.createNestedObject(a,i,t):a[e]=t,r.push(a))}return r},h.prototype.createNestedObject=function(e,t,l){for(var r,n=t.length-1,i=0;i<n;++i)(r=t[i])in e||(e[r]={}),e=e[r];e[t[n]]=l},h.prototype.getDistinctValues=function(e,t){for(var l={},r=[],n=0,i=e.length;n<i;n++){var o=e[n][t];Number(e[n][t])===e[n][t]&&e[n][t]%1!=0&&(o=e[n][t].toString());var s={};o in l||(l[o]=1,s[t]=o,r.push(s))}return r},h.prototype.renderMultiSelect=function(e,t,l,i,o){var s,a=!1,u=!1;this.dataColl[1]&&Object.keys(this.dataColl[1]).indexOf(e.field)>-1&&(a=!0,s=this.getDistinctValues(this.dataColl,e.field)),!this.dataColl.length&&o.length&&(u=!0);var d=new r.MultiSelect({dataSource:u?o:a?s:this.dataManager,query:new n.Query([e.field]),fields:{text:e.field,value:e.field},placeholder:this.l10n.getConstant("SelectValue"),value:i,mode:"CheckBox",width:"100%",change:this.changeValue.bind(this,l),close:this.closePopup.bind(this,l),actionBegin:this.multiSelectOpen.bind(this,t+"_valuekey"+l)});d.appendTo("#"+t+"_valuekey"+l),this.updateRules(d.element,i,0)},h.prototype.multiSelectOpen=function(e,l){if(this.dataSource instanceof n.DataManager){var r=document.getElementById(e),i=t.getComponent(t.closest(r,".e-rule-container").querySelector(".e-filter-input"),"dropdownlist");this.selectedColumn=i.getDataByValue(i.value);var o=this.selectedColumn.field,s=!1;this.dataColl[1]&&Object.keys(this.dataColl[1]).indexOf(o)>-1&&(s=!0),s||(l.cancel=!0,t.isBlazor()?this.bindBlazorMultiSelectData(r,o):this.bindMultiSelectData(r,o))}},h.prototype.bindBlazorMultiSelectData=function(e,t){return p(this,void 0,void 0,function(){return c(this,function(l){switch(l.label){case 0:return[4,this.getMultiSelectData(e,t)];case 1:return l.sent(),[2]}})})},h.prototype.bindMultiSelectData=function(e,t){this.getMultiSelectData(e,t)},h.prototype.getMultiSelectData=function(e,l){var r,i=this,o=new n.Deferred,s=this.dataManager.executeQuery((new n.Query).select(l)),u=t.getComponent(e,"multiselect");u.hideSpinner(),this.createSpinner(t.closest(e,".e-multi-select-wrapper").parentElement),a.showSpinner(t.closest(e,".e-multi-select-wrapper").parentElement),s.then(function(n){r=n.actual&&n.actual.result?n.actual.result:n.result,i.dataColl=t.extend(i.dataColl,r,[],!0),u.dataSource=i.getDistinctValues(i.dataColl,l),a.hideSpinner(t.closest(e,".e-multi-select-wrapper").parentElement)}).catch(function(e){o.reject(e)})},h.prototype.createSpinner=function(e){var l=this.createElement("span",{attrs:{class:"e-qb-spinner"}});e.appendChild(l),a.createSpinner({target:l,width:t.Browser.isDevice?"16px":"14px"})},h.prototype.closePopup=function(e,l){var r=document.getElementById(l.popup.element.id.replace("_popup","")),n=t.getComponent(r,"multiselect").value;this.updateRules(r,n,e)},h.prototype.processTemplate=function(e,l,r,n){var i,o=t.closest(e,".e-rule-container"),s=o.querySelectorAll(".e-template");i=t.getComponent(o.querySelector(".e-rule-filter .e-filter-input"),"dropdownlist");var a=this.getColumn(i.value);s.length<2?l.template&&"string"==typeof l.template.write?t.getValue(l.template.write,window)({elements:s[0],values:r.value,operator:n.operator,field:a.field,dataSource:a.values}):l.template&&l.template.write&&l.template.write({elements:s[0],values:r.value,operator:n.operator,field:a.field,dataSource:a.values}):l.template&&"string"==typeof l.template.write?t.getValue(l.template.write,window)({elements:s,values:r.value,operator:n.operator,field:a.field,dataSource:a.values}):l.template&&l.template.write&&l.template.write({elements:s,values:r.value,operator:n.operator,field:a.field,dataSource:a.values})},h.prototype.getItemData=function(e){var l=t.getComponent(document.getElementById(e+"_filterkey"),"dropdownlist");return this.getColumn(l.value)},h.prototype.setDefaultValue=function(e,l,r){var n=this.getItemData(e);if(t.isNullOrUndefined(n.value))return r?l?[0,0]:0:l?[]:"";if(l){if(!(n.value instanceof Array))return[n.value]}else if(n.value instanceof Array)return n.value[0];return n.value},h.prototype.renderStringValue=function(e,t,l,r,n){var o,s,a=this.getItemData(e);if(s=this.isImportRules||this.isPublic?t.value:this.setDefaultValue(e,!1,!1),"in"!==l&&"notin"!==l||!this.dataColl.length&&!a.values){"in"!==l&&"notin"!==l||(s=(o=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1)).join(","));var u=new i.TextBox({placeholder:this.l10n.getConstant("SelectValue"),input:this.changeValue.bind(this,r)});u.appendTo("#"+e+"_valuekey"+r),u.value=s,u.dataBind()}else o=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1),this.renderMultiSelect(a,e,r,o,a.values),"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?n.style.width="100%":(n.style.width=null,n.style.minWidth="200px")},h.prototype.renderNumberValue=function(e,l,r,n,o,s,a){var u=this.getItemData(e),d=this.isImportRules||this.isPublic?l.value:this.setDefaultValue(e,!1,!0);if("in"!==r&&"notin"!==r||!this.dataColl.length&&!u.values)if("in"===r||"notin"===r){var p=(d=this.isImportRules?l.value:this.setDefaultValue(e,!0,!1)).join(","),c=new i.TextBox({placeholder:this.l10n.getConstant("SelectValue"),input:this.changeValue.bind(this,n)});c.appendTo("#"+e+"_valuekey"+n),c.value=p,c.dataBind()}else{var h=t.getComponent(document.getElementById(e+"_filterkey"),"dropdownlist"),m=(s=this.getColumn(h.value)).validation&&s.validation.min?s.validation.min:0,g=s.validation&&s.validation.max?s.validation.max:Number.MAX_VALUE,f=s.format?s.format:"n";a>1&&l&&(d=l.value[n]?l.value[n]:this.setDefaultValue(e,!0,!0)),new i.NumericTextBox({value:d instanceof Array?d[n]:d,format:f,min:m,max:g,width:"100%",step:s.step?s.step:1,change:this.changeValue.bind(this,n)}).appendTo("#"+e+"_valuekey"+n)}else d=this.isImportRules?l.value:this.setDefaultValue(e,!0,!1),this.renderMultiSelect(u,e,n,d,u.values),this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?o.style.width="100%":(o.style.minWidth="200px",o.style.width=null)},h.prototype.processValueString=function(e,t){var l=[],r=e.split(",");if("string"===t)return r;for(var n=0,i=r.length;n<i;n++)l.push(Number(r[n]));return l},h.prototype.parseDate=function(e,l){var r,n;if(l){var i=this.intl.getDateParser({skeleton:"full",type:"dateTime"});r=this.getFormat(l),n=i(e),t.isNullOrUndefined(n)&&(n=this.intl.parseDate(e,r))}else n=new Date(e);return n},h.prototype.renderControls=function(e,l,r,n){if(t.addClass([e.parentElement.querySelector(".e-rule-value")],"e-value"),t.removeClass([e.parentElement.querySelector(".e-rule-value")],"e-hide"),t.addClass([e.parentElement.querySelector(".e-rule-value")],"e-show"),l.template)this.processTemplate(e,l,r,n);else{var i;i="boolean"===n.type?this.selectedColumn.values?this.selectedColumn.values.length:2:n.operator&&n.operator.toString().toLowerCase().indexOf("between")>-1?2:1;var s=t.closest(e,".e-rule-container").id,a=void 0,u=void 0;if(u=n.operator.toString(),e.className.indexOf("e-rule-operator")>-1||e.className.indexOf("e-rule-filter")>-1){a=e.parentElement.querySelector(".e-rule-value"),this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?a.style.width="100%":"in"!==u&&"notin"!==u&&(a.style.width="200px");for(var d=0;d<i;d++)switch(n.type){case"string":this.renderStringValue(s,r,u,d,a);break;case"number":this.renderNumberValue(s,r,u,d,a,l,i);break;case"boolean":this.processBoolValues(l,r,s,d);break;case"date":var p=new Date,c=void 0,h=void 0,m=l.format,g=void 0,f=this.l10n.getConstant("SelectValue");if(l.value&&(p=l.value instanceof Date?l.value:l.value instanceof Number?new Date(l.value):this.parseDate(l.value,l.format)),(this.isImportRules||this.isPublic)&&r&&r.value&&(h=this.getColumn(r.field),c=i>1?r.value[d]:r.value,p=this.parseDate(c,h.format),m=h.format),m){var y=this.getFormat(m);g=y.skeleton?new o.DatePicker({locale:this.getLocale(),value:p,placeholder:f,format:y,change:this.changeValue.bind(this,d)}):new o.DatePicker({value:p,locale:this.getLocale(),placeholder:f,format:y.format,change:this.changeValue.bind(this,d)})}else g=new o.DatePicker({locale:this.getLocale(),value:p,placeholder:f,change:this.changeValue.bind(this,d)});g.appendTo("#"+s+"_valuekey"+d),r.value||this.updateRules(document.getElementById(s+"_valuekey"+d),p)}}}},h.prototype.processBoolValues=function(e,r,n,i){var o,s,a=!1;if(t.isNullOrUndefined(r.type)&&e&&(r.type=e.type),e.values){u=e.values;"boolean"!==r.type||t.isNullOrUndefined(r.value)?e.value?a=u[i].toLowerCase()===e.value.toString().toLowerCase():0===i&&(a=!0):a=u[i].toLowerCase()===r.value.toString().toLowerCase(),s=o=u[i]}else{var u=[!0,!1];"boolean"!==r.type||t.isNullOrUndefined(r.value)?e.value?a=u[i].toString().toLowerCase()===e.value.toString().toLowerCase():0===i&&(a=!0):a=u[i].toString().toLowerCase()===r.value.toString().toLowerCase(),o=u[i].toString(),s=u[i]}var d=new l.RadioButton({label:o,name:n+"default",checked:a,value:o,change:this.changeValue.bind(this,i)});d.appendTo("#"+n+"_valuekey"+i),a&&this.updateRules(d.element,s,0)},h.prototype.getOperatorIndex=function(e,t){var l,r=e.dataSource.length;for(l=0;l<r;l++)if(t.operator===e.dataSource[l].value)return l;return 0},h.prototype.renderValues=function(e,l,r,n,i,o,s){var a=document.getElementById(s.id.replace("operatorkey","filterkey")),u=t.getComponent(a,"dropdownlist");if(n){var d=t.getComponent(e.querySelector("input"),"dropdownlist");l.operators?(d.value=null,d.dataBind(),d.dataSource=l.operators,d.index=this.getOperatorIndex(d,i),d.value=o.operator=d.dataSource[d.index].value,d.dataBind()):l.type&&(d.value=null,d.dataBind(),d.dataSource=this.customOperators[l.type+"Operator"],d.index=this.getOperatorIndex(d,i),d.value=o.operator=d.dataSource[d.index].value,d.dataBind())}var p=o.operator.toString();if(!(p.indexOf("null")>-1||p.indexOf("empty")>-1)){var c=t.closest(e,".e-rule-container").id;r&&r.template&&(this.templateDestroy(r,c+"_valuekey0"),t.isBlazor()?r.field!==l.field&&(t.blazorTemplates[this.element.id+r.field]=[],t.resetBlazorTemplate(this.element.id+r.field,"Template"),t.detach(e.nextElementSibling.querySelector(".e-blazor-template"))):t.detach(e.nextElementSibling.querySelector("#"+c+"_valuekey0"))),n&&(t.isBlazor()&&!r.template?this.destroyControls(e):t.isBlazor()||this.destroyControls(e));var h=this.getColumn(u.value);if(l.template=h.template,l.template){if(t.isBlazor()&&l.field){this.columnTemplateFn=this.templateParser(l.template);var m=this.element.id+l.field,g=this.columnTemplateFn(l,this,"Template",m);e.nextElementSibling.appendChild(g[0]),t.updateBlazorTemplate(m,"Template",h,!1)}t.addClass([e.nextElementSibling],"e-template-value"),l.template=h.template;C=void 0;if(l.template&&"string"==typeof l.template.create?C=t.getValue(l.template.create,window)({field:h.field,operator:l.value||p}):l.template&&l.template.create&&(C=l.template.create({field:h.field,operator:l.value||p})),C instanceof Element)C.id=c+"_valuekey0",t.addClass([C],"e-template"),t.addClass([C],"e-"+h.field),e.nextElementSibling.appendChild(C);else if(C instanceof Array){t.addClass(C,"e-template");for(var f=0,y=C.length;f<y;f++)C[f].id=c+"_valuekey"+f,e.nextElementSibling.appendChild(C[f])}var v=e.parentElement.querySelector(".e-rule-value");this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?v.style.width="100%":v.style.width="200px"}else{t.removeClass([e.nextElementSibling],"e-template-value");var b=1;b="boolean"===o.type?this.selectedColumn.values?this.selectedColumn.values.length:2:p&&p.toLowerCase().indexOf("between")>-1?2:1;for(f=0;f<b;f++){var C=void 0;C=this.createElement("input",{attrs:{type:"text",id:c+"_valuekey"+f}}),e.nextElementSibling.appendChild(C)}}this.renderControls(e,l,i,o)}},h.prototype.updateValues=function(e,l){var r=1;e.className.indexOf("e-template")>-1&&(r=3);var n=e.className.split(" e-")[r],i=parseInt(e.id.slice(-1),2);switch(n){case"textbox":case"dropdownlist":l.value=t.getComponent(e,n).value;break;case"radio":var o=t.getComponent(e,n);o.checked&&("boolean"==typeof l.value?l.value="true"===o.value:this.getColumn(l.field).values?l.value=o.value:l.value="true"===o.value),o.refresh();break;case"numerictextbox":l.operator.indexOf("between")>-1?("string"==typeof l.value&&(l.value=[]),l.value[i]=t.getComponent(e,n).value):l.value=t.getComponent(e,n).value;break;case"datepicker":var s=this.getColumn(l.field),a=this.getFormat(s.format),u=t.getComponent(e,n).value;l.operator.indexOf("between")>-1?("string"==typeof l.value&&(l.value=[]),l.value[i]=u):t.isNullOrUndefined(a.format)&&u?l.value=this.intl.formatDate(u):l.value=u?this.intl.formatDate(u,a):"";break;case"multiselect":l.value=t.getComponent(e,n).value}},h.prototype.updateRules=function(e,l,r){for(var n,i,o,s=t.closest(e,".e-group-container"),a=this.getParentGroup(s),u=t.closest(e,".e-rule-container"),d=0,p=s.id.replace(this.element.id+"_",""),c=this.getValidRules(this.rule);u&&null!==u.previousElementSibling;)u=u.previousElementSibling,d++;var h=a.rules[d].operator.toString();if(u=t.closest(e,".e-rule-container"),o=u.id.replace(this.element.id+"_",""),t.closest(e,".e-rule-filter")){n=t.getComponent(e,"dropdownlist");var m=this.getColumn(n.value);this.isImportRules||a.rules[d].field.toLowerCase()===m.field.toLowerCase()||(!u.querySelectorAll(".e-template")&&!(h.indexOf("null")>-1)||h.indexOf("empty")>-1)&&(a.rules[d].value=""),this.selectedColumn=n.getDataByValue(n.value),a.rules[d].field=this.selectedColumn.field,a.rules[d].type=this.selectedColumn.type,a.rules[d].label=this.selectedColumn.label;var g=t.closest(e,".e-rule-filter"),f=g.nextElementSibling.querySelector("input.e-control");h=t.getComponent(f,"dropdownlist").value.toString(),a.rules[d].operator=h;var y=g.nextElementSibling.nextElementSibling,v=y.querySelectorAll("input.e-control");v.length<1&&(v=y.querySelectorAll(".e-template"));for(var b=0;b<v.length;b++)v[b]||(v[b]=g.nextElementSibling.nextElementSibling.querySelector("div.e-control")),v[b]||(v[b]=g.nextElementSibling.nextElementSibling.querySelector(".e-template")),i={groupID:p,ruleID:o,value:a.rules[d].field,type:"field"},h.indexOf("null")>-1||h.indexOf("empty")>-1?a.rules[d].value=null:this.updateValues(v[b],a.rules[d]);this.isImportRules||this.trigger("change",i),this.allowValidation&&a.rules[d].field&&e.parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(e.parentElement,"tooltip").destroy(),this.filterRules(c,this.getValidRules(this.rule),"field")}else if(t.closest(e,".e-rule-operator")){n=t.getComponent(e,"dropdownlist"),a.rules[d].operator=n.value.toString();var C=void 0;e.parentElement;C=u.querySelectorAll(".e-rule-value input.e-control"),i={groupID:p,ruleID:o,value:n.value,type:"operator"},this.allowValidation&&a.rules[d].operator&&e.parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(e.parentElement,"tooltip").destroy(),C.length>1&&!(C[0].className.indexOf("e-template")>-1)&&(a.rules[d].value=[]);for(var S=0;S<C.length;S++)a.rules[d].operator.indexOf("null")>-1||a.rules[d].operator.indexOf("empty")>-1?a.rules[d].value=null:C[S].classList.contains("e-template")||this.updateValues(C[S],a.rules[d]);this.isImportRules||this.trigger("change",i),this.filterRules(c,this.getValidRules(this.rule),"operator")}else t.closest(e,".e-rule-value")&&(this.ruleValueUpdate(e,l,a,d,s,u,r),this.filterRules(c,this.getValidRules(this.rule),"value"))},h.prototype.filterRules=function(e,t,l){JSON.stringify({condition:e.condition,not:e.not,rule:e.rules})!==JSON.stringify({condition:t.condition,not:t.not,rule:t.rules})&&(this.isImportRules||this.trigger("ruleChange",{previousRule:e,rule:t,type:l}))},h.prototype.ruleValueUpdate=function(e,l,n,i,o,s,a){var u,d,p=["in","between","notin","notbetween"];if(n.rules[i].operator&&(d=n.rules[i].operator.toString().toLowerCase()),null!==l){if(e.className.indexOf("e-multiselect")>-1&&"number"===n.rules[i].type&&!(e.className.indexOf("e-template")>-1)){for(var c=[],h=l,m=0,g=h.length;m<g;m++)"string"==typeof h[m]&&c.push(parseFloat(h[m]));c.length&&(l=c)}if(e.classList.contains("e-blazor-template")||e.className.indexOf("e-template")>-1)n.rules[i].value=l,u={groupID:o.id,ruleID:s.id,value:n.rules[i].value,type:"value"},this.isImportRules||this.trigger("change",u);else if(e.className.indexOf("e-spin")>-1||e.className.indexOf("e-numeric")>-1)p.indexOf(d)>-1?n.rules[i].value[a]=l:n.rules[i].value=l;else if(e.className.indexOf("e-radio")>-1)n.rules[i].value=l;else if(e.className.indexOf("e-multiselect")>-1)n.rules[i].value=l;else if(e.className.indexOf("e-textbox")>-1)"in"===d||"notin"===d?(n.rules[i].type,n.rules[i].value=this.processValueString(l,n.rules[i].type)):n.rules[i].value=l;else if(e.className.indexOf("e-datepicker")>-1){var f=t.getInstance(s.querySelector(".e-rule-filter input"),r.DropDownList),y=this.getFormat(this.getColumn(f.value).format);y.type&&(p.indexOf(d)>-1?("string"==typeof n.rules[i].value&&(n.rules[i].value=[]),n.rules[i].value[a]=this.intl.formatDate(l,y)):n.rules[i].value=this.intl.formatDate(l,y))}this.validatValue(n,i,s)}else e.className.indexOf("e-datepicker")>-1&&(p.indexOf(d)>-1?("string"==typeof n.rules[i].value&&(n.rules[i].value=[]),n.rules[i].value[a]=""):n.rules[i].value="")},h.prototype.validatValue=function(e,l,r){if(this.allowValidation&&e.rules[l].value){var n=r.querySelectorAll(".e-rule-value .e-control");n[0].className.indexOf("e-tooltip")>-1?t.getComponent(n[0],"tooltip").destroy():n[0].parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(n[0].parentElement,"tooltip").destroy(),n[1]&&n[1].parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(n[1].parentElement,"tooltip").destroy()}},h.prototype.getFormat=function(e){var t;return e?"string"==typeof e?(t={type:"dateTime",format:e},"short"===e&&(t.skeleton=e)):t={type:"dateTime",skeleton:e.skeleton}:t={type:"dateTime",skeleton:"yMd"},t},h.prototype.findGroupByIdx=function(e,t,l){var r=t.rules,n=[];if(!l){for(var i=0,o=r.length;i<o;i++)(t=r[i]).rules&&n.push(t);return n[e]}return t},h.prototype.destroy=function(){if(this.element){var l,r,n,i;for(e.prototype.destroy.call(this),n=(l=this.element.querySelectorAll(".e-addrulegroup")).length,r=0;r<n;r++)t.getComponent(l[r],"dropdown-btn").destroy(),t.detach(l[r]);for(i=this.element.querySelectorAll(".e-rule-filter .e-control.e-tooltip"),r=0;r<i.length;r++)t.getComponent(i[r],"tooltip").destroy();for(n=(l=this.element.querySelectorAll(".e-rule-filter .e-control:not(.e-tooltip)")).length,r=0;r<n;r++)t.getComponent(l[r],"dropdownlist").destroy(),t.detach(l[r]);for(i=this.element.querySelectorAll(".e-rule-operator .e-control.e-tooltip"),r=0;r<i.length;r++)t.getComponent(i[r],"tooltip").destroy();for(n=(l=this.element.querySelectorAll(".e-rule-operator .e-control:not(.e-tooltip)")).length,r=0;r<n;r++)t.getComponent(l[r],"dropdownlist").destroy(),t.detach(l[r]);for(i=this.element.querySelectorAll(".e-rule-value .e-control.e-tooltip"),r=0;r<i.length;r++)t.getComponent(i[r],"tooltip").destroy();this.isImportRules=!1,this.unWireEvents(),this.levelColl[this.element.id+"_group0"]=[0],this.element.innerHTML="",t.classList(this.element,[],["e-rtl","e-responsive","e-device"])}},h.prototype.addRules=function(e,t){t=this.element.id+"_"+t,this.isPublic=!0;for(var l=0,r=e.length;l<r;l++)this.addRuleElement(document.getElementById(t),e[l]);this.isPublic=!1},h.prototype.addGroups=function(e,t){t=this.element.id+"_"+t;var l=document.getElementById(t),r=this.getParentGroup(l);if(e.length){this.isPublic=!0;for(var n=0,i=e.length;n<i;n++)this.updatedRule={condition:e[n].condition,not:e[n].not},this.importRules(e[n],l);this.isPublic=!1}else{var o="and",s=!1;this.updatedRule&&(o=this.updatedRule.condition,s=this.updatedRule.not),this.enableNotCondition?r.rules.push({condition:o,not:s,rules:[]}):r.rules.push({condition:o,rules:[]})}var a=l.querySelector(".e-btngroup-and"),u=l.querySelector(".e-btngroup-or");a.disabled&&(a.removeAttribute("disabled"),a.checked=!0,u.removeAttribute("disabled"))},h.prototype.initWrapper=function(){if(this.isInitialLoad=!0,this.cssClass&&t.addClass([this.element],this.cssClass),this.enableRtl&&t.addClass([this.element],"e-rtl"),this.width&&(this.element.style.width=this.width),this.height&&(this.element.style.height=this.height),this.rule.rules.length?this.isImportRules=!0:this.addGroupElement(!1,this.element),t.Browser.isDevice||"Vertical"===this.displayMode?(t.Browser.isDevice&&(this.element.style.width="100%",this.element.classList.add("e-device")),t.removeClass(this.element.querySelectorAll(".e-rule-container"),"e-horizontal-mode"),t.addClass(this.element.querySelectorAll(".e-rule-container"),"e-vertical-mode"),this.displayMode="Vertical"):this.displayMode="Horizontal",this.summaryView)this.isImportRules?this.renderSummary():this.renderSummaryCollapse();else{if(this.columns.length&&this.isImportRules){this.addGroupElement(!1,this.element,this.rule.condition);var e=t.extend({},this.rule,{},!0);this.setGroupRules(e)}else this.columns.length&&this.addRuleElement(this.element.querySelector(".e-group-container"),{});this.notGroupRtl(),this.readonly&&this.enableReadonly();for(var l=this.element.querySelectorAll("label.e-btn"),r=void 0,n=0;n<l.length;n++)r=l.item(n),t.rippleEffect(r,{selector:".e-btn"})}},h.prototype.renderSummary=function(){var e=this.createElement("div",{attrs:{class:"e-summary-content",id:this.element.id+"_summary_content"}}),t=this.createElement("textarea",{attrs:{class:"e-summary-text",readonly:"true"},styles:"max-height:500px"}),l=this.createElement("button",{attrs:{class:"e-edit-rule e-css e-btn e-small e-flat e-primary"}}),r=this.createElement("div",{attrs:{class:"e-summary-btndiv"}});e.appendChild(t),t.textContent=this.getSqlFromRules(this.rule),l.textContent=this.l10n.getConstant("Edit"),r.appendChild(l),e.appendChild(r),this.element.appendChild(e)},h.prototype.renderSummaryCollapse=function(){var e=this.createElement("div",{attrs:{class:"e-collapse-rule e-icons",title:this.l10n.getConstant("SummaryViewTitle")}});this.element.querySelector(".e-group-header").appendChild(e)},h.prototype.columnSort=function(){"descending"===this.sortDirection.toLowerCase()?this.columns=new n.DataManager(this.columns).executeLocal((new n.Query).sortByDesc("field")):"ascending"===this.sortDirection.toLowerCase()&&(this.columns=new n.DataManager(this.columns).executeLocal((new n.Query).sortBy("field")))},h.prototype.onChangeNotGroup=function(){if(this.element.innerHTML="",this.groupIdCounter=0,this.enableNotCondition){if(this.enableNotCondition){var e=this.createElement("button",{attrs:{type:"button",class:"e-qb-toggle"}});this.groupElem.querySelector(".e-btn-group").insertBefore(e,this.groupElem.querySelector(".e-btngroup-and"))}}else this.groupElem.querySelector(".e-qb-toggle").remove();this.rule=this.checkNotGroup(this.rule),this.initWrapper()},h.prototype.notGroupRtl=function(){this.enableRtl?t.addClass(this.element.querySelectorAll(".e-btn-group"),"e-rtl"):t.removeClass(this.element.querySelectorAll(".e-btn-group"),"e-rtl")},h.prototype.checkNotGroup=function(e){var l;if(e.rules)for(var r=0;r<e.rules.length;r++)l=e.rules[r],l=this.checkNotGroup(l),e.rules[r]=l;return t.isNullOrUndefined(e.not)?this.enableNotCondition&&!t.isNullOrUndefined(e.condition)&&(e.not=!1):(this.enableNotCondition&&(e.not=!1),delete e.not),e},h.prototype.onPropertyChanged=function(e,l){for(var r=0,n=Object.keys(e);r<n.length;r++)switch(n[r]){case"summaryView":var i=this.element.querySelector(".e-group-container"),o=this.element.querySelector(".e-summary-content");e.summaryView?(i.style.display="none",this.element.querySelectorAll(".e-summary-content").length<1?(this.renderSummary(),o=this.element.querySelector(".e-summary-content")):this.element.querySelector(".e-summary-text").textContent=this.getSqlFromRules(this.rule),o.style.display="block"):(i.querySelectorAll(".e-collapse-rule").length>-1&&this.renderSummaryCollapse(),i.style.display="block",o.style.display="none");break;case"displayMode":this.refresh();break;case"showButtons":e.showButtons.ruleDelete?t.removeClass(this.element.querySelectorAll(".e-rule-delete"),"e-button-hide"):t.addClass(this.element.querySelectorAll(".e-rule-delete"),"e-button-hide"),e.showButtons.groupDelete?t.removeClass(this.element.querySelectorAll(".e-deletegroup"),"e-button-hide"):t.addClass(this.element.querySelectorAll(".e-deletegroup"),"e-button-hide");break;case"cssClass":l.cssClass&&t.removeClass([this.element],l.cssClass.split(" ")),e.cssClass&&t.addClass([this.element],e.cssClass.split(" "));break;case"enableRtl":e.enableRtl?(t.addClass([this.element],"e-rtl"),this.notGroupRtl()):(t.removeClass([this.element],"e-rtl"),this.notGroupRtl());break;case"enablePersistence":this.enablePersistence=e.enablePersistence;break;case"dataSource":this.dataSource=e.dataSource,this.refresh();break;case"columns":if(t.isBlazor()){for(var s=Object.keys(e.columns).toString(),a=e.columns[s].values;!this.target.classList.contains("e-blazor-template");)this.target=this.target.parentElement;this.updateRules(this.target,a)}else this.columns=e.columns;this.columnSort();break;case"sortDirection":this.sortDirection=e.sortDirection,this.columnSort();break;case"maxGroupCount":this.maxGroupCount=e.maxGroupCount;break;case"height":this.height=e.height,this.element.style.height=this.height;break;case"rule":this.rule=e.rule,e.rule=this.getRuleCollection(this.rule,!1);break;case"width":this.width=e.width,this.element.style.width=this.width;break;case"locale":this.locale=e.locale,this.intl=new t.Internationalization(this.locale),this.isLocale=!0,this.refresh(),this.isLocale=!1;break;case"enableNotCondition":this.onChangeNotGroup();break;case"readonly":this.isReadonly=e.readonly,this.enableReadonly()}},h.prototype.preRender=function(){this.element.id=this.element.id||t.getUniqueID("ej2-querybuilder"),this.defaultLocale={StartsWith:"Starts With",EndsWith:"Ends With",Contains:"Contains",Equal:"Equal",NotEqual:"Not Equal",LessThan:"Less Than",LessThanOrEqual:"Less Than Or Equal",GreaterThan:"Greater Than",GreaterThanOrEqual:"Greater Than Or Equal",Between:"Between",NotBetween:"Not Between",In:"In",NotIn:"Not In",Remove:"REMOVE",SelectField:"Select a field",SelectOperator:"Select operator",DeleteRule:"Remove this condition",DeleteGroup:"Delete group",AddGroup:"Add Group",AddCondition:"Add Condition",Edit:"EDIT",ValidationMessage:"This field is required",SummaryViewTitle:"Summary View",OtherFields:"Other Fields",AND:"AND",OR:"OR",NOT:"NOT",SelectValue:"Enter Value",IsEmpty:"Is Empty",IsNotEmpty:"Is Not Empty",IsNull:"Is Null",IsNotNull:"Is Not Null"},this.l10n=new t.L10n("querybuilder",this.defaultLocale,this.locale),this.intl=new t.Internationalization(this.locale),this.groupIdCounter=0,this.ruleIdCounter=0,this.btnGroupId=0,this.isImportRules=!1,this.parser=[],this.customOperators={stringOperator:[{value:"startswith",key:this.l10n.getConstant("StartsWith")},{value:"endswith",key:this.l10n.getConstant("EndsWith")},{value:"contains",key:this.l10n.getConstant("Contains")},{value:"equal",key:this.l10n.getConstant("Equal")},{value:"notequal",key:this.l10n.getConstant("NotEqual")},{value:"in",key:this.l10n.getConstant("In")},{value:"notin",key:this.l10n.getConstant("NotIn")},{value:"isempty",key:this.l10n.getConstant("IsEmpty")},{value:"isnotempty",key:this.l10n.getConstant("IsNotEmpty")}],dateOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"greaterthan",key:this.l10n.getConstant("GreaterThan")},{value:"greaterthanorequal",key:this.l10n.getConstant("GreaterThanOrEqual")},{value:"lessthan",key:this.l10n.getConstant("LessThan")},{value:"lessthanorequal",key:this.l10n.getConstant("LessThanOrEqual")},{value:"notequal",key:this.l10n.getConstant("NotEqual")}],booleanOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"notequal",key:this.l10n.getConstant("NotEqual")}],numberOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"greaterthanorequal",key:this.l10n.getConstant("GreaterThanOrEqual")},{value:"greaterthan",key:this.l10n.getConstant("GreaterThan")},{value:"between",key:this.l10n.getConstant("Between")},{value:"lessthan",key:this.l10n.getConstant("LessThan")},{value:"notbetween",key:this.l10n.getConstant("NotBetween")},{value:"lessthanorequal",key:this.l10n.getConstant("LessThanOrEqual")},{value:"notequal",key:this.l10n.getConstant("NotEqual")},{value:"in",key:this.l10n.getConstant("In")},{value:"notin",key:this.l10n.getConstant("NotIn")}]},this.operators={equal:"=",notequal:"!=",greaterthan:">",greaterthanorequal:">=",lessthan:"<",in:"IN",notin:"NOT IN",lessthanorequal:"<=",startswith:"LIKE",endswith:"LIKE",between:"BETWEEN",notbetween:"NOT BETWEEN",contains:"LIKE",isnull:"IS NULL",isnotnull:"IS NOT NULL",isempty:"IS EMPTY",isnotempty:"IS NOT EMPTY",notstartswith:"NOT LIKE",notendswith:"NOT LIKE",notcontains:"NOT LIKE"},this.fields||(this.fields={text:"label",value:"field"})},h.prototype.render=function(){if(this.levelColl={},this.items=[{text:this.l10n.getConstant("AddGroup"),iconCss:"e-icons e-add-icon e-addgroup"},{text:this.l10n.getConstant("AddCondition"),iconCss:"e-icons e-add-icon e-addrule"}],this.ruleElem=this.ruleTemplate(),this.groupElem=this.groupTemplate(),!t.isBlazor()){var e=[{value:"isnull",key:this.l10n.getConstant("IsNull")},{value:"isnotnull",key:this.l10n.getConstant("IsNotNull")}],l=[{value:"isnull",key:this.l10n.getConstant("IsNull")},{value:"isnotnull",key:this.l10n.getConstant("IsNotNull")}];this.customOperators.stringOperator=this.customOperators.stringOperator.concat(e),this.customOperators.numberOperator=this.customOperators.numberOperator.concat(l)}this.dataSource instanceof n.DataManager?(this.dataManager=this.dataSource,this.executeDataManager((new n.Query).take(1))):(this.dataManager=new n.DataManager(this.dataSource),this.dataColl=this.dataManager.executeLocal(new n.Query),this.initControl()),this.renderComplete()},h.prototype.templateParser=function(e){if(e)try{if(document.querySelectorAll(e).length)return t.compile(document.querySelector(e).innerHTML.trim())}catch(l){return t.compile(e)}},h.prototype.executeDataManager=function(e){var t=this,l=this.dataManager.executeQuery(e),r=new n.Deferred;l.then(function(e){e.actual&&e.actual.result?t.dataColl=e.actual.result:t.dataColl=e.result,t.initControl()}).catch(function(e){r.reject(e)})},h.prototype.initControl=function(){this.initialize(),this.initWrapper(),this.wireEvents()},h.prototype.wireEvents=function(){var e=this.getWrapper();t.EventHandler.add(e,"click",this.clickEventHandler,this),t.EventHandler.add(e,"focusout",this.focusEventHandler,this),t.EventHandler.add(e,"focusin",this.focusEventHandler,this),t.EventHandler.add(this.element,"keydown",this.keyBoardHandler,this)},h.prototype.unWireEvents=function(){var e=this.getWrapper();t.EventHandler.remove(e,"click",this.clickEventHandler),t.EventHandler.remove(e,"focusout",this.focusEventHandler),t.EventHandler.remove(e,"focusin",this.focusEventHandler),t.EventHandler.remove(this.element,"keydown",this.keyBoardHandler)},h.prototype.getParentGroup=function(e,t){for(var l=e instanceof Element?this.levelColl[e.id]:this.levelColl[e],r=t?l.length-1:l.length,n=this.rule,i=0;i<r;i++)n=this.findGroupByIdx(l[i],n,0===i);return n},h.prototype.deleteGroup=function(e){var t=this,l={groupID:e.id.replace(this.element.id+"_",""),cancel:!1,type:"deleteGroup"};this.isImportRules?this.deleteGroupSuccessCallBack(l,e):this.trigger("beforeChange",l,function(l){t.deleteGroupSuccessCallBack(l,e)})},h.prototype.deleteGroupSuccessCallBack=function(e,l){if(!e.cancel){this.actionButton&&t.getComponent(this.actionButton,"tooltip").destroy();var r=l,n=this.getParentGroup(r,!0),i=0,o=void 0,s=void 0,a=this.getValidRules(this.rule),u=r.nextElementSibling,d=r.previousElementSibling,p=r.querySelectorAll(".e-group-container"),c=r.querySelectorAll(".e-tooltip");for(s=c.length,o=0;o<s;o++)t.getComponent(c[o],"tooltip").destroy();for(o=0,s=p.length;o<s;o++)delete this.levelColl[p[o].id];for(;null!==r.previousElementSibling;)r=r.previousElementSibling,i++;u&&u.className.indexOf("e-separate-rule")>-1&&(t.removeClass([u],"e-separate-rule"),t.addClass([u],"e-joined-rule"),d&&d.className.indexOf("e-rule-container")>-1&&t.addClass([d],"e-prev-joined-rule")),n.rules.splice(i,1),delete this.levelColl[e.groupID];var h=r.parentElement.parentElement.parentElement;t.detach(l),this.refreshLevelColl(),this.disableRuleCondition(h,n),this.isImportRules||this.trigger("change",e),this.filterRules(a,this.getValidRules(this.rule),"deleteGroup")}},h.prototype.deleteRule=function(e){var l,r,n=this,i={groupID:r=t.closest(e,".e-group-container").id.replace(this.element.id+"_",""),ruleID:l=t.closest(e,".e-rule-container").id.replace(this.element.id+"_",""),cancel:!1,type:"deleteRule"};this.isImportRules?this.deleteRuleSuccessCallBack(i,e):this.trigger("beforeChange",i,function(t){n.deleteRuleSuccessCallBack(t,e)})},h.prototype.deleteRuleSuccessCallBack=function(e,l){if(!e.cancel){this.actionButton&&this.actionButton.className.indexOf("e-tooltip")>-1&&t.getComponent(this.actionButton,"tooltip").destroy();var r=t.closest(l,".e-group-container"),n=this.getParentGroup(r),i=t.closest(l,".e-rule-container"),o=this.getValidRules(this.rule),s=i,a=i.nextElementSibling,u=i.previousElementSibling,d=0,p=i.querySelectorAll(".e-tooltip"),c=void 0,h=p.length;for(c=0;c<h;c++)t.getComponent(p[c],"tooltip").destroy();for(;null!==i.previousElementSibling;)i=i.previousElementSibling,d++;n.rules.splice(d,1),(!u||u.className.indexOf("e-rule-container")<0)&&a&&t.removeClass([a],"e-joined-rule"),(!a||a.className.indexOf("e-rule-container")<0)&&u&&t.removeClass([u],"e-prev-joined-rule"),t.detach(s),n.rules[0]&&n.rules[0].rules||this.disableRuleCondition(r,n),this.isImportRules||this.trigger("change",e),this.filterRules(o,this.getValidRules(this.rule),"deleteRule")}},h.prototype.setGroupRules=function(e){this.reset(),this.groupIdCounter=1,this.ruleIdCounter=0,this.isImportRules=!0,this.rule=e,e=this.getRuleCollection(this.rule,!1),this.importRules(this.rule,this.element.querySelector(".e-group-container"),!0),this.isImportRules=!1},h.prototype.keyBoardHandler=function(e){(this.readonly&&38===e.keyCode||40===e.keyCode||13===e.keyCode)&&e.preventDefault()},h.prototype.disableRuleCondition=function(e,t){if(!this.readonly){var l=e.querySelector(".e-rule-list").childElementCount,r=e.querySelector(".e-btngroup-and"),n=e.querySelector(".e-btngroup-or");l>1?(r.disabled=!1,n.disabled=!1,(n.nextElementSibling.classList.contains("e-btn-disable")||r.nextElementSibling.classList.contains("e-btn-disable"))&&(n.nextElementSibling.classList.remove("e-btn-disable"),r.nextElementSibling.classList.remove("e-btn-disable")),t&&"or"===t.condition?n.checked=!0:r.checked=!0):(r.checked=!1,r.disabled=!0,n.checked=!1,n.disabled=!0,t&&(n.nextElementSibling.classList.add("e-btn-disable"),r.nextElementSibling.classList.add("e-btn-disable")))}},h.prototype.getValidRules=function(e){e||(e=this.getRules());var l=e.condition,r=e.not,n=t.extend([],e.rules,[],!0);return this.getRuleCollection({condition:l,rules:n,not:r},!0)},h.prototype.getRuleCollection=function(e,t){var l;if(e.rules&&e.rules.length&&(Object.keys(e.rules[0]).length>6||t))for(var r=e.rules.length,n=0;n<r;n++)l=e.rules[n],l=this.getRuleCollection(l,t),e.rules[n]=l,Object.keys(l).length<1&&t&&(e.rules.splice(n,1),n--,r--);if(e.condition||""===e.condition)e=this.enableNotCondition?{condition:e.condition,rules:e.rules,not:e.not}:{condition:e.condition,rules:e.rules};else if(e.operator&&(e.operator.toString().indexOf("null")>-1||e.operator.toString().indexOf("empty")>-1)&&(e.value=null),""!==e.field&&""!==e.operator&&""!==e.value){var i=e.custom;e={label:e.label,field:e.field,operator:e.operator,type:e.type,value:e.value},i&&(e.custom=i)}else e={};return e},h.prototype.setRules=function(e){var l=t.extend({},e,{},!0);this.setGroupRules(l)},h.prototype.getRules=function(){return this.enableNotCondition?{condition:this.rule.condition,rules:this.rule.rules,not:this.rule.not}:{condition:this.rule.condition,rules:this.rule.rules}},h.prototype.getRule=function(e){var l,r,n=0;e instanceof HTMLElement?l=t.closest(e,".e-rule-container"):(r=this.element.id+"_"+e,l=document.getElementById(r));for(var i=t.closest(l,".e-group-container"),o=this.getParentGroup(i);null!==l.previousElementSibling;)l=l.previousElementSibling,n++;return o.rules[n]},h.prototype.getGroup=function(e){e instanceof Element&&e.className.indexOf("e-group-container")<1&&(e=t.closest(e,".e-group-container"));var l=e instanceof Element?e.id:this.element.id+"_"+e,r=this.getParentGroup(l);return this.enableNotCondition?{rules:r.rules,condition:r.condition,not:r.not}:{rules:r.rules,condition:r.condition}},h.prototype.deleteGroups=function(e){var t,l,r=e.length;for(t=0;t<r;t++)l=this.element.id+"_"+e[t],this.deleteGroup(document.getElementById(l))},h.prototype.getFilteredRecords=function(){var e,l=this.getPredicate(this.getValidRules(this.rule));if(e=t.isNullOrUndefined(l)?new n.Query:(new n.Query).where(l),t.isBlazor()){var r=new n.UrlAdaptor,i=new n.DataManager({url:"",adaptor:new n.UrlAdaptor}),o=r.processQuery(i,e),s=JSON.parse(o.data);return Object.keys(s).length?s:null}return this.dataManager.executeQuery(e)},h.prototype.deleteRules=function(e){var t,l,r=e.length;for(t=0;t<r;t++)l=this.element.id+"_"+e[t],this.deleteRule(document.getElementById(l))},h.prototype.getDataManagerQuery=function(e){for(var t=this.getPredicate(e),l=[],r=0,i=Object.keys(this.columns);r<i.length;r++)l.push(this.columns[r].field);return e.rules.length?(new n.Query).select(l).where(t):(new n.Query).select(l)},h.prototype.getPredicate=function(e){var t,l,r,i,o=e.rules,s=!1,a=["notcontains","notstartswith","notendswith"];if(!o)return t;for(var u=0,d=o.length;u<d;u++)if(s=!1,Object.keys(o[u]).indexOf("rules")>-1&&o[u].rules)(l=this.getPredicate(o[u]))&&(t=t?"and"===e.condition?t.and(l):t.or(l):l);else if(o[u].operator.length){var p=o[u].operator.toLowerCase(),c=!1,h=["equal","notequal","greaterthan","lessthanorequal"];if("string"===o[u].type&&(s=!this.matchCase),"date"===o[u].type&&h.indexOf(p)>-1&&(s=!0),i=this.getColumn(o[u].field),"date"!==o[u].type||o[u].value instanceof Array)p.indexOf("null")>-1||p.indexOf("empty")>-1?o[u].value=null:r=o[u].value;else{var m=this.getFormat(i.format);r=this.getDate(o[u].value,m),h.indexOf(p)>-1&&(c=!0)}if(0===u)c||(p.indexOf("in")>-1||p.indexOf("between")>-1||p.indexOf("null")>-1||p.indexOf("empty")>-1)&&p.indexOf("contains")<0?t=c?this.datePredicate(o[u],r):this.arrayPredicate(o[u]):""!==(g=r)&&a.indexOf(p)<0&&(t=new n.Predicate(o[u].field,o[u].operator,r,s));else{if(a.indexOf(p)>-1)continue;if(c||(p.indexOf("in")>-1||p.indexOf("between")>-1||p.indexOf("null")>-1||p.indexOf("empty")>-1)&&p.indexOf("contains")<0)t=c?this.datePredicate(o[u],r,t,e.condition):this.arrayPredicate(o[u],t,e.condition);else if("and"===e.condition){g=r;t&&""!==g?t=t.and(o[u].field,o[u].operator,r,s):""!==g&&(t=new n.Predicate(o[u].field,o[u].operator,r,s))}else{var g=r;t&&""!==g?t=t.or(o[u].field,o[u].operator,r,s):""!==g&&(t=new n.Predicate(o[u].field,o[u].operator,r,s))}}}return t},h.prototype.getLocale=function(){var e=t.isBlazor()?".dates.days.short":".dates.calendars.gregorian.days.format.short",l=this.locale,r=t.isBlazor()?"":"main.";return t.getValue(r+""+this.locale+e,t.cldrData)||(l="en"),l},h.prototype.getColumn=function(e){e=e.split(".")[0];for(var t,l=this.columns,r=0,n=l.length;r<n;r++)l[r].field===e&&(t=l[r]);return t},h.prototype.getOperators=function(e){return this.getColumn(e).operators},h.prototype.datePredicate=function(e,t,l,r){var i,o=new Date(t.getTime()),s=new Date(o.setDate(o.getDate()+1));switch(e.operator){case"equal":i=(i=new n.Predicate(e.field,"greaterthanorequal",t)).and(e.field,"lessthan",s);break;case"notequal":i=(i=new n.Predicate(e.field,"lessthan",t)).or(e.field,"greaterthanorequal",s);break;case"greaterthan":i=new n.Predicate(e.field,"greaterthanorequal",s);break;case"lessthanorequal":i=new n.Predicate(e.field,"lessthan",s)}return i&&(l?"and"===r?l=l.and(i):"or"===r&&(l=l.or(i)):l=i),l},h.prototype.arrayPredicate=function(e,t,l){var r,i,o=e.value,s=e.operator.toString(),a=e.value,u=this.getColumn(e.field);if(r=this.getFormat(u.format),s.indexOf("null")>-1||s.indexOf("empty")>-1)switch(s){case"isnull":i=new n.Predicate(e.field,"isnull",a);break;case"isnotnull":i=new n.Predicate(e.field,"notnull",a);break;case"isempty":i=new n.Predicate(e.field,"equal","");break;case"isnotempty":i=new n.Predicate(e.field,"notequal","")}if(!(s.indexOf("null")>-1||s.indexOf("empty")>-1))for(var d=0,p=o.length;d<p;d++)if(""!==o[d])if(0===d)switch(s){case"between":i="date"===u.type?new n.Predicate(e.field,"greaterthanorequal",this.getDate(o[d],r)):new n.Predicate(e.field,"greaterthanorequal",o[d]);break;case"notbetween":i="date"===u.type?new n.Predicate(e.field,"lessthan",this.getDate(o[d],r)):new n.Predicate(e.field,"lessthan",o[d]);break;case"in":i=new n.Predicate(e.field,"equal",o[d]);break;case"notin":i=new n.Predicate(e.field,"notequal",o[d])}else switch(e.operator){case"between":if("date"===u.type){var c=this.getDate(o[d],r),h=new Date(c.setDate(c.getDate()+1));i=i.and(e.field,"lessthan",h)}else i=i.and(e.field,"lessthanorequal",o[d]);break;case"notbetween":i="date"===u.type?i.or(e.field,"greaterthan",this.getDate(o[d],r)):i.or(e.field,"greaterthan",o[d]);break;case"in":i=i.or(e.field,"equal",o[d]);break;case"notin":i=i.and(e.field,"notequal",o[d])}return i&&(t?"and"===l?t=t.and(i):"or"===l&&(t=t.or(i)):t=i),t},h.prototype.getDate=function(e,t){var l=this.intl.parseDate(e,t);return e.indexOf(":")>-1&&(e.indexOf("/")<0||e.indexOf(",")<0)&&l.setDate((new Date).getDate()),l},h.prototype.importRules=function(e,l,r){if(r){if(e.rules.length>1){var n=l.querySelector(".e-btngroup-or"),i=l.querySelector(".e-btngroup-and");n.disabled=!1,i.disabled=!1,"or"===e.condition?n.checked=!0:i.checked=!0}else this.disableRuleCondition(l);if(this.enableNotCondition){var o=l.querySelector(".e-qb-toggle");e.not?t.addClass([o],"e-active-toggle"):t.removeClass([o],"e-active-toggle")}}else l=this.renderGroup(e.condition,l);var s=e.rules;if(!t.isNullOrUndefined(s))for(var a=0,u=s.length;a<u;a++){var d=Object.keys(s[a]);!t.isNullOrUndefined(s[a].rules)&&d.indexOf("rules")>-1?(l=this.renderGroup(s[a].condition,l),l=this.importRules(s[a],l,!0)):this.renderRule(s[a],l)}return(l=t.closest(l,".e-rule-list"))&&(l=t.closest(l,".e-group-container")),l},h.prototype.renderGroup=function(e,t){this.addGroupElement(!0,t,e);var l=t.querySelectorAll(".e-group-container");return l[l.length-1]},h.prototype.renderRule=function(e,t){t.className.indexOf("e-group-container")>-1?this.addRuleElement(t,e):this.addRuleElement(t.querySelector(".e-group-container"),e)},h.prototype.enableReadonly=function(){for(var e=this.element.querySelectorAll(".e-dropdownlist, .e-numerictextbox, .e-textbox, .e-datepicker, .e-multiselect .e-lib, .e-radio"),n=0;n<e.length;n++)e[n].classList.contains("e-dropdownlist")?t.getInstance(e[n],r.DropDownList).readonly=this.isReadonly:e[n].classList.contains("e-numerictextbox")?t.getInstance(e[n],i.NumericTextBox).readonly=this.isReadonly:e[n].classList.contains("e-textbox")?t.getInstance(e[n],i.TextBox).readonly=this.isReadonly:e[n].classList.contains("e-datepicker")?t.getInstance(e[n],o.DatePicker).readonly=this.isReadonly:e[n].classList.contains("e-multiselect")?t.getInstance(e[n],r.MultiSelect).readonly=this.isReadonly:e[n].classList.contains("e-radio")&&(t.getInstance(e[n],l.RadioButton).checked||(this.isReadonly?e[n].parentElement.style.display="none":e[n].parentElement.style.display="inherit"));var s=this.element.querySelectorAll(".e-deletegroup"),a=this.element.querySelectorAll(".e-addrulegroup"),u=this.element.querySelectorAll(".e-removerule");!this.isReadonly&&this.ruleElem.classList.contains("e-readonly")&&this.ruleElem.classList.remove("e-readonly");for(var d=[s,a,u],n=0;n<d.length;n++)d[n].forEach(function(e){e.classList.contains("e-readonly")?e.classList.remove("e-readonly"):e.classList.add("e-readonly")});this.enableBtnGroup()},h.prototype.enableBtnGroup=function(){var e=this,t=!1;this.element.querySelectorAll(".e-btngroup-and-lbl, .e-btngroup-or-lbl, .e-qb-toggle").forEach(function(l){!l.classList.contains("e-qb-toggle")||l.classList.contains("e-active-toggle")||l.classList.contains("e-readonly")?l.classList.contains("e-qb-toggle")&&l.classList.contains("e-not-readonly")?l.classList.remove("e-not-readonly"):l.classList.contains("e-qb-toggle")&&l.classList.contains("e-readonly")?l.classList.remove("e-readonly"):l.classList.contains("e-active-toggle")?(l.classList.add("e-not-readonly"),t=!0):l.previousElementSibling.checked||l.classList.contains("e-readonly")?(l.classList.remove("e-readonly"),t?"AND"===l.textContent?l.classList.add("e-readonly-and"):l.classList.add("e-readonly-or"):("AND"===l.textContent&&e.isReadonly?(l.classList.remove("e-not"),l.classList.add("e-readonly-and")):(e.enableNotCondition&&l.classList.add("e-not"),l.classList.remove("e-readonly-and")),"OR"===l.textContent&&e.isReadonly?l.classList.add("e-readonly-or-not"):l.classList.remove("e-readonly-or-not"))):l.classList.contains("e-btn-disable")||l.classList.add("e-readonly"):(l.classList.add("e-readonly"),t=!1)})},h.prototype.getSqlString=function(e,t,l){var r=!1;l||""===l?l+="(":(l="",r=!0);var n=e.condition;e.not&&(l+=r?"NOT (":" NOT (");for(var i=0,o=e.rules.length;i<o;i++){if(e.rules[i].rules)l=this.getSqlString(e.rules[i],t,l);else{var s=e.rules[i],a="";if(s.value instanceof Array)if(s.operator.toString().indexOf("between")>-1)"date"===s.type?a+='"'+s.value[0]+'" AND "'+s.value[1]+'"':a+=s.value[0]+" AND "+s.value[1];else if("string"==typeof s.value[0]){a+='("'+s.value[0]+'"';for(var u=1,d=s.value.length;u<d;u++)a+=',"'+s.value[u]+'"';a+=")"}else a+="("+s.value+")";else s.operator.toString().indexOf("startswith")>-1?a+='("'+s.value+'%")':s.operator.toString().indexOf("endswith")>-1?a+='("%'+s.value+'")':s.operator.toString().indexOf("contains")>-1?a+='("%'+s.value+'%")':"number"===s.type||"boolean"==typeof s.value?a+=s.value:a+='"'+s.value+'"';s.operator.toString().indexOf("null")>-1||s.operator.toString().indexOf("empty")>-1?(t&&(s.field="`"+s.field+"`"),l+=s.field+" "+this.operators[s.operator]):(t&&(s.field="`"+s.field+"`"),l+=s.field+" "+this.operators[s.operator]+" "+a)}i!==o-1&&(l+=" "+n.toUpperCase()+" ")}return r||(l+=")"),e.not&&(l+=")"),l},h.prototype.setRulesFromSql=function(e){e=e.replace(/`/g,"");var t=this.getRulesFromSql(e);this.setRules({condition:t.condition,not:t.not,rules:t.rules})},h.prototype.getRulesFromSql=function(e){this.parser=[],this.sqlParser(e),this.rule={condition:"and",not:!1,rules:[]};var t=this.processParser(this.parser,this.rule,[0]);return this.enableNotCondition?{condition:t.condition,not:t.not,rules:t.rules}:{condition:t.condition,rules:t.rules}},h.prototype.getSqlFromRules=function(e,t){return e||(e=this.getValidRules()),e=this.getRuleCollection(e,!1),this.getSqlString(this.getValidRules(e),t).replace(/"/g,"'")},h.prototype.sqlParser=function(e){var t,l=0;do{t=e.slice(l),l+=this.parseSqlStrings(t)}while(""!==t);return this.parser},h.prototype.parseSqlStrings=function(e){for(var t,l,r=["=","!=","<=",">=","<",">"],n=["AND","OR","NOT"],i=["IN","NOT IN","LIKE","NOT LIKE","BETWEEN","NOT BETWEEN","IS NULL","IS NOT NULL","IS EMPTY","IS NOT EMPTY"],o=0,s=r.length;o<s;o++)if(t=/^\w+$/.test(r[o])?"\\b":"",new RegExp("^("+r[o]+")"+t,"ig").exec(e))return this.parser.push(["Operators",r[o].toLowerCase()]),r[o].length;var a=this.parser[this.parser.length-1];if(!a||a&&"Literal"!==a[0])for(var o=0,s=n.length;o<s;o++)if(t=/^\w+$/.test(n[o])?"\\b":"",new RegExp("^("+n[o]+")"+t,"ig").exec(e))return this.parser.push(["Conditions",n[o].toLowerCase()]),n[o].length;for(var o=0,s=i.length;o<s;o++)if(t=/^\w+$/.test(i[o])?"\\b":"",new RegExp("^("+i[o]+")"+t,"ig").exec(e))return this.parser.push(["SubOperators",i[o].toLowerCase()]),i[o].length;return/^\(/.exec(e)?(this.parser.push(["Left","("]),1):/^\)/.exec(e)?(this.parser.push(["Right",")"]),1):/^`?([a-z_][a-z0-9_]{0,}(\:(number|float|string|date|boolean))?)`?/i.exec(e)?(l=/^`?([a-z_][a-z0-9_]{0,}(\:(number|float|string|date|boolean))?)`?/i.exec(e)[1],this.parser.push(["Literal",l]),l.length):/^'((?:[^\\']+?|\\.|'')*)'(?!')/.exec(e)?(l=/^'((?:[^\\']+?|\\.|'')*)'(?!')/.exec(e)[0],this.parser.push(["String",l]),l.length):/^"([^\\"]*(?:\\.[^\\"]*)*)"/.exec(e)?(l=/^"([^\\"]*(?:\\.[^\\"]*)*)"/.exec(e)[0],this.parser.push(["DoubleString",l]),l.length):/^[0-9]+(\.[0-9]+)?/.exec(e)?(l=/^[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Number",l]),l.length):/^-?[0-9]+(\.[0-9]+)?/.exec(e)?(l=/^-?[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Number",l]),l.length):1},h.prototype.getOperator=function(e,t){var l={"=":"equal","!=":"notequal","<":"lessthan",">":"greaterthan","<=":"lessthanorequal",">=":"greaterthanorequal",in:"in","not in":"notin",between:"between","not between":"notbetween","is empty":"isempty","is null":"isnull","is not null":"isnotnull","is not empty":"isnotempty"};return 0===e.indexOf("%")&&"%"===e[e.length-1]?"not like"===t?"notcontains":"contains":0!==e.indexOf("%")&&e.indexOf("%")===e.length-1?"not like"===t?"notstartswith":"startswith":0===e.indexOf("%")&&e.indexOf("%")!==e.length-1?"not like"===t?"notendswith":"endswith":l[t]},h.prototype.getTypeFromColumn=function(e){for(var t=this.columns,l=0;l<t.length;l++)if(t[l].field===e.field){e.type=t[l].type;break}return e.type},h.prototype.processParser=function(e,t,l){for(var r,n,i,o,s,a,u,d,p,c,h=[],m=[],g=0,f=e.length;g<f;g++)if("Literal"===e[g][0]){if(i={label:e[g][1],field:e[g][1]},"SubOperators"===e[g+1][0]){for(e[g+1][1].indexOf("null")>-1||e[g+1][1].indexOf("empty")>-1?(i.operator=this.getOperator(" ",e[g+1][1]),i.value=null,i.type=this.getTypeFromColumn(i)):i.operator=this.getOperator(e[g+3][1].replace(/'/g,""),e[g+1][1]),c=e[g+1][1],r=++g+1,n=f,r=g+1;r<n;r++){if("Right"===e[r][0]){g=r;break}if(c.indexOf("null")>-1||c.indexOf("empty")>-1)break;if(c.indexOf("like")>-1&&"String"===e[r][0])i.value=e[r][1].replace(/'/g,"").replace(/%/g,""),i.type="string";else if(c.indexOf("between")>-1){if("Literal"===e[r][0]||"Left"===e[r][0])break;"Number"===e[r][0]?h.push(Number(e[r][1])):"String"===e[r][0]&&m.push(e[r][1].replace(/'/g,""))}else"Number"===e[r][0]?h.push(Number(e[r][1])):"String"===e[r][0]&&m.push(e[r][1].replace(/'/g,""));i.type=this.getTypeFromColumn(i)}c.indexOf("like")<0&&("Number"===e[r-1][0]?(i.value=h,i.type="number"):"String"===e[r-1][0]?(i.value=m,i.type="string"):c.indexOf("between")>-1&&"Conditions"===e[r-1][0]&&(i.value=h,i.type="number"),h=[],m=[],i.type=this.getTypeFromColumn(i))}else"Operators"===e[g+1][0]&&(i.operator=this.getOperator(e[g+2][1],e[g+1][1]),"Number"===e[g+2][0]?(i.type="number",i.value=Number(e[g+2][1])):(i.type="string",i.value=e[g+2][1].replace(/'/g,"")),i.type=this.getTypeFromColumn(i));t.rules.push(i)}else{if("Left"===e[g][0]){if("Left"!==e[0][0]&&"not"===e[g-1][1])continue;for(this.parser=e.splice(g+1,f-(g+1)),o=this.enableNotCondition?{condition:"and",rules:[],not:!1}:{condition:"and",rules:[]},p=0,a=t.rules.length,s=0;s<a;s++)t.rules[s].rules&&p++;return l.push(p),t.rules.push(o),o=this.processParser(this.parser,o,l),t}if("Conditions"===e[g][0])"not"===e[g][1]?t.not=!0:t.condition=e[g][1];else if("Right"===e[g][0]){for(this.parser=e.splice(g+1,f-(g+1)),l.pop(),t=this.rule,d=l.length,u=0;u<d;u++)t=this.findGroupByIdx(l[u],t,0===u);return this.processParser(this.parser,t,l)}}return t},h.prototype.isBlazor=function(){return-1!==Object.keys(window).indexOf("ejsInterop")},d([t.Event()],h.prototype,"created",void 0),d([t.Event()],h.prototype,"actionBegin",void 0),d([t.Event()],h.prototype,"beforeChange",void 0),d([t.Event()],h.prototype,"change",void 0),d([t.Event()],h.prototype,"ruleChange",void 0),d([t.Property({ruleDelete:!0,groupInsert:!0,groupDelete:!0})],h.prototype,"showButtons",void 0),d([t.Property(!1)],h.prototype,"summaryView",void 0),d([t.Property(!1)],h.prototype,"allowValidation",void 0),d([t.Property([])],h.prototype,"columns",void 0),d([t.Property("")],h.prototype,"cssClass",void 0),d([t.Property([])],h.prototype,"dataSource",void 0),d([t.Property("Horizontal")],h.prototype,"displayMode",void 0),d([t.Property(!1)],h.prototype,"enablePersistence",void 0),d([t.Property("Default")],h.prototype,"sortDirection",void 0),d([t.Property(5)],h.prototype,"maxGroupCount",void 0),d([t.Property("auto")],h.prototype,"height",void 0),d([t.Property("auto")],h.prototype,"width",void 0),d([t.Property(!1)],h.prototype,"matchCase",void 0),d([t.Property(0)],h.prototype,"immediateModeDelay",void 0),d([t.Property(!1)],h.prototype,"enableNotCondition",void 0),d([t.Property(!1)],h.prototype,"readonly",void 0),d([t.Complex({condition:"and",rules:[]},m)],h.prototype,"rule",void 0),h=d([t.NotifyPropertyChanges],h)}(t.Component);return e.Columns=h,e.Rule=m,e.ShowButtons=g,e.QueryBuilder=f,e}({},ej.base,ej.buttons,ej.dropdowns,ej.data,ej.inputs,ej.calendars,ej.splitbuttons,ej.popups),this.ejs=ej;
//# sourceMappingURL=ej2-querybuilder.min.js.map
